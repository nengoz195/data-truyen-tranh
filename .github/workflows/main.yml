name: Auto update data.json

on:
  workflow_dispatch:
  push:
    paths:
      - "linh-khe/**"
      - "lac-nguyet-son-ha/**" # Äáº£m báº£o dÃ²ng nÃ y cÃ³ máº·t Ä‘á»ƒ theo dÃµi folder má»›i
      - "generate.js"

jobs:
  update-data:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Cáº¥p quyá»n ghi file

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Run generate script
        run: node generate.js

      - name: Commit updated data
        run: |
          # 1. Cáº¥u hÃ¬nh bot
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # 2. Kiá»ƒm tra thay Ä‘á»•i
          if [[ -n $(git status --porcelain) ]]; then
            echo "ğŸ“ CÃ³ thay Ä‘á»•i data, Ä‘ang xá»­ lÃ½..."
            
            # 3. Add file (láº¥y cáº£ data.json vÃ  data-lnsh.json)
            git add *.json
            git commit -m "auto: update manga data files"
            
            # 4. QUAN TRá»ŒNG: KÃ©o code má»›i nháº¥t vá» trÆ°á»›c khi Ä‘áº©y (Sá»­a lá»—i Fetch First)
            git pull --rebase origin main
            
            # 5. Äáº©y lÃªn
            git push origin main
          else
            echo "âœ… KhÃ´ng cÃ³ thay Ä‘á»•i nÃ o."
          fi

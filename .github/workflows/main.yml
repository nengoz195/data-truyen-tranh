name: Auto update data.json

on:
  workflow_dispatch:
  push:
    paths:
      - "linh-khe/**"
      - "lac-nguyet-son-ha/**"  # <--- ÄÃ£ thÃªm dÃ²ng nÃ y Ä‘á»ƒ theo dÃµi folder má»›i
      - "generate.js"

jobs:
  update-data:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Cáº¥p quyá»n ghi file cho bot

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Run generate script
        run: node generate.js

      - name: Commit updated data
        run: |
          # Cáº¥u hÃ¬nh bot
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # Kiá»ƒm tra xem cÃ³ báº¥t ká»³ thay Ä‘á»•i nÃ o khÃ´ng (cho cáº£ 2 file json)
          if [[ -n $(git status --porcelain) ]]; then
            echo "ðŸ“ PhÃ¡t hiá»‡n thay Ä‘á»•i dá»¯ liá»‡u..."
            
            # Add táº¥t cáº£ file .json (bao gá»“m cáº£ data.json vÃ  data-lnsh.json)
            git add *.json
            
            git commit -m "auto: update manga data files"
            git push
          else
            echo "âœ… KhÃ´ng cÃ³ thay Ä‘á»•i nÃ o trong file data."
          fi
